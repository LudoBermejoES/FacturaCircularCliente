<% breadcrumb ["Companies", companies_path],
              [@company[:name], company_path(@company[:id])],
              ["Contacts", company_company_contacts_path(@company[:id])],
              [@contact[:name], edit_company_company_contact_path(@company[:id], @contact[:id])],
              "Addresses" %>

<div class="space-y-6">
  <!-- Header -->
  <div class="sm:flex sm:items-center sm:justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Addresses for <%= @contact[:name] %></h1>
      <p class="mt-1 text-sm text-gray-600">
        Manage addresses for this contact
      </p>
    </div>
    <div class="mt-4 sm:mt-0">
      <%= link_to new_company_company_contact_address_path(@company[:id], @contact[:id]),
          class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
        <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        Add Address
      <% end %>
    </div>
  </div>

  <!-- Addresses Grid -->
  <div class="bg-white shadow rounded-lg">
    <% if @addresses && @addresses.any? %>
      <!-- Header -->
      <div class="px-4 py-5 sm:px-6">
        <h3 class="text-lg font-medium text-gray-900">
          <%= pluralize(@total_count || @addresses.size, 'address') %>
        </h3>
      </div>

      <!-- Address Grid -->
      <div class="border-t border-gray-200 p-6">
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" data-controller="contact-addresses"
             data-contact-addresses-company-id-value="<%= @company[:id] %>"
             data-contact-addresses-contact-id-value="<%= @contact[:id] %>">
          <% @addresses.each do |address| %>
            <div class="border rounded-lg p-4 <%= 'ring-2 ring-indigo-500 bg-indigo-50' if address[:is_default] %>">
              <!-- Address Type and Default Badge -->
              <div class="flex justify-between items-start mb-3">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                       <%= address[:address_type] == 'billing' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800' %>">
                  <%= address[:display_type] || address[:address_type].humanize %>
                </span>
                <% if address[:is_default] %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"
                        data-contact-addresses-target="defaultBadge"
                        data-address-id="<%= address[:id] %>">
                    Default
                  </span>
                <% else %>
                  <span class="hidden inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"
                        data-contact-addresses-target="defaultBadge"
                        data-address-id="<%= address[:id] %>">
                    Default
                  </span>
                <% end %>
              </div>

              <!-- Address Display -->
              <address class="not-italic text-sm text-gray-600 mb-4">
                <%= address[:street_address] %><br>
                <%= address[:city] %><% if address[:state_province].present? %>, <%= address[:state_province] %><% end %><br>
                <%= address[:postal_code] %><br>
                <span class="font-medium"><%= address[:country_name] || address[:country_code] %></span>
              </address>

              <!-- Action Buttons -->
              <div class="flex flex-wrap gap-2">
                <%= link_to "Edit",
                    edit_company_company_contact_address_path(@company[:id], @contact[:id], address[:id]),
                    class: "text-sm text-indigo-600 hover:text-indigo-900 font-medium" %>

                <% unless address[:is_default] %>
                  <%= button_to "Set as Default",
                      set_default_company_company_contact_address_path(@company[:id], @contact[:id], address[:id]),
                      method: :post,
                      data: {
                        "contact-addresses-target": "setDefaultButton",
                        "address-id": address[:id],
                        "action": "contact-addresses#setDefault"
                      },
                      class: "text-sm text-green-600 hover:text-green-900 font-medium border-none bg-transparent p-0 cursor-pointer" %>
                <% end %>

                <%= button_to "Delete",
                    company_company_contact_address_path(@company[:id], @contact[:id], address[:id]),
                    method: :delete,
                    data: { confirm: "Are you sure you want to delete this address?" },
                    class: "text-sm text-red-600 hover:text-red-900 font-medium border-none bg-transparent p-0 cursor-pointer" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <!-- Empty State -->
      <div class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No addresses</h3>
        <p class="mt-1 text-sm text-gray-500">
          Get started by adding an address for this contact.
        </p>
        <div class="mt-6">
          <%= link_to new_company_company_contact_address_path(@company[:id], @contact[:id]),
              class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Add First Address
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Back to Contact -->
  <div class="flex justify-start">
    <%= link_to company_company_contacts_path(@company[:id]),
        class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
      <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
      </svg>
      Back to Contacts
    <% end %>
  </div>
</div>