<% breadcrumb "Products", products_path %>
<% breadcrumb @product[:name] %>

<div class="space-y-6">
  <div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:px-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-gray-900"><%= @product[:name] %></h1>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">
            SKU: <%= @product[:sku] %>
          </p>
        </div>
        <div class="flex items-center space-x-3">
          <% if @product[:is_active] %>
            <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">
              Active
            </span>
          <% else %>
            <span class="inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
              Inactive
            </span>
          <% end %>

          <div class="flex items-center space-x-2">
            <%= link_to edit_product_path(@product[:id]),
                        class: "inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
              <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
              </svg>
              Edit
            <% end %>

            <%= link_to duplicate_product_path(@product[:id]),
                        method: :post,
                        class: "inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",
                        data: { confirm: "Create a copy of this product?" } do %>
              <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" />
              </svg>
              Duplicate
            <% end %>

            <% if @product[:is_active] %>
              <%= link_to deactivate_product_path(@product[:id]),
                          method: :post,
                          class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",
                          data: { confirm: "Deactivate this product?" } do %>
                <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
                Deactivate
              <% end %>
            <% else %>
              <%= link_to activate_product_path(@product[:id]),
                          method: :post,
                          class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" do %>
                <svg class="-ml-0.5 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                Activate
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <div class="border-t border-gray-200">
      <dl>
        <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">Description</dt>
          <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
            <%= @product[:description].present? ? @product[:description] : "No description provided" %>
          </dd>
        </div>
        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">Base Price</dt>
          <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
            <span class="text-lg font-semibold">
              <%= number_to_currency(@product[:base_price], unit: "€", precision: 2) %>
            </span>
            <span class="text-gray-500">(<%= @product[:currency_code] %>)</span>
          </dd>
        </div>
        <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">Tax Rate</dt>
          <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium
              <%= case @product[:tax_rate]
                  when 21 then 'bg-blue-100 text-blue-800'
                  when 10 then 'bg-yellow-100 text-yellow-800'
                  when 4 then 'bg-orange-100 text-orange-800'
                  when 0 then 'bg-gray-100 text-gray-800'
                  else 'bg-purple-100 text-purple-800'
                  end %>">
              <%= @product[:tax_rate] %>%
            </span>
            <% if @product[:tax_description] %>
              <span class="ml-2 text-gray-500">(<%= @product[:tax_description] %>)</span>
            <% end %>
          </dd>
        </div>
        <% if @product[:price_with_tax] %>
          <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-500">Price with Tax</dt>
            <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
              <span class="text-lg font-semibold">
                <%= number_to_currency(@product[:price_with_tax], unit: "€", precision: 2) %>
              </span>
              <span class="text-gray-500">including <%= @product[:tax_rate] %>% tax</span>
            </dd>
          </div>
        <% end %>
        <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-gray-500">Status</dt>
          <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
            <% if @product[:is_active] %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-green-100 text-green-800">
                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
                  <circle cx="4" cy="4" r="3" />
                </svg>
                Active
              </span>
              <p class="mt-1 text-xs text-gray-500">This product is available for use in invoices</p>
            <% else %>
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                <svg class="-ml-0.5 mr-1.5 h-2 w-2 text-gray-400" fill="currentColor" viewBox="0 0 8 8">
                  <circle cx="4" cy="4" r="3" />
                </svg>
                Inactive
              </span>
              <p class="mt-1 text-xs text-gray-500">This product is not available for use in invoices</p>
            <% end %>
          </dd>
        </div>
        <% if @product[:created_at] %>
          <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-500">Created</dt>
            <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
              <%= Time.parse(@product[:created_at]).strftime("%B %d, %Y at %I:%M %p") %>
            </dd>
          </div>
        <% end %>
        <% if @product[:updated_at] %>
          <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
            <dt class="text-sm font-medium text-gray-500">Last Updated</dt>
            <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
              <%= Time.parse(@product[:updated_at]).strftime("%B %d, %Y at %I:%M %p") %>
            </dd>
          </div>
        <% end %>
      </dl>
    </div>
  </div>

  <!-- Tax Helper Information -->
  <% if @product[:standard_tax] || @product[:reduced_tax] || @product[:super_reduced_tax] || @product[:tax_exempt] %>
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6">
        <h3 class="text-lg leading-6 font-medium text-gray-900">Tax Information</h3>
        <p class="mt-1 max-w-2xl text-sm text-gray-500">Spanish tax compliance details</p>
      </div>
      <div class="border-t border-gray-200 px-4 py-5 sm:px-6">
        <div class="grid grid-cols-2 gap-4 sm:grid-cols-4">
          <div class="text-center">
            <div class="text-lg font-semibold <%= @product[:standard_tax] ? 'text-blue-600' : 'text-gray-400' %>">
              <%= @product[:standard_tax] ? '✓' : '×' %>
            </div>
            <div class="text-sm text-gray-500">Standard Tax (21%)</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-semibold <%= @product[:reduced_tax] ? 'text-yellow-600' : 'text-gray-400' %>">
              <%= @product[:reduced_tax] ? '✓' : '×' %>
            </div>
            <div class="text-sm text-gray-500">Reduced Tax (10%)</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-semibold <%= @product[:super_reduced_tax] ? 'text-orange-600' : 'text-gray-400' %>">
              <%= @product[:super_reduced_tax] ? '✓' : '×' %>
            </div>
            <div class="text-sm text-gray-500">Super Reduced (4%)</div>
          </div>
          <div class="text-center">
            <div class="text-lg font-semibold <%= @product[:tax_exempt] ? 'text-gray-600' : 'text-gray-400' %>">
              <%= @product[:tax_exempt] ? '✓' : '×' %>
            </div>
            <div class="text-sm text-gray-500">Tax Exempt (0%)</div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Action Buttons -->
  <div class="flex justify-between">
    <div>
      <%= link_to products_path, class: "inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
        <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>
        Back to Products
      <% end %>
    </div>
    <div class="flex space-x-3">
      <%= link_to edit_product_path(@product[:id]), class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
        <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
        </svg>
        Edit Product
      <% end %>
      <%= link_to product_path(@product[:id]),
                  method: :delete,
                  class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",
                  data: { confirm: "Are you sure you want to delete this product? This action cannot be undone." } do %>
        <svg class="-ml-1 mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
        </svg>
        Delete Product
      <% end %>
    </div>
  </div>
</div>